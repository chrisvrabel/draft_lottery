<!--
# Chris Vrabel
# 5/27/17
# Prediting Game Probabilities

# This is the html file for the webpage of visualizations. Contains the javascript as well. 
-->
<html>
<title>Draft Lottery</title>
<head>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<!-- Load the d3 library. -->
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<style>
/* put a border around the svg element so we can see the coordinate system better. */
body { font-family: "Open Sans"; }
.right { 
  float: right; 
  width: 18%; 
  height: 100%;
  border-size: 1px;
  border-style: solid;
  border-color: #6496c8;
  margin: 5px;
}
.left { 
  margin: 10px;
  float: left; 
  width:75%; 
  height:95%;
}
.stack { 
  float: left; 
  width: 100%;
}
#top {
  height: 25%;
}
#mid {
  height: 55%;
}
#bot {
  height: 20%;
}
.title { 
  display: block;
  text-align: center;
  font-size: 60px;
  font-weight: bolder;
  text-overflow: ellipsis;
}
#rightTitle {
  margin-top: 10px;
  height: 8%;
  text-align: center;
  font-size: 30;
  font-weight: bold;
}
button {
  margin: 0 auto;
  padding: 7px 22px;
  font-size: 24px;
  font-family: "Bitter",serif;
  line-height: 0.9;
  appearance: none;
  box-shadow: none;
  border-radius: 0;
}
button:focus {
  outline: none;
}
#master {
  margin-top: 30px;
}
button {
  color: #fff;
  background-color: #6496c8;
  text-shadow: -1px 1px #417cb8;
  border: none;
}
button:hovor {
  background-color: #346392;
  text-shadow: -1px 1px #27496d;
}
button:active {
  background-color: #27496d;
  text-shadow: -1px 1px #193047
}
.mainButtons {
  display: block;
  margin: 5;
  margin-bottom: 20px
}
#mainButtonDiv {
  float: left;
  width: 20%;
  margin-top: 30px;
}
#lottoNumbersDiv {
  float: right;
  width: 80%;
}
.numAndButton {
  display: inline-block;
  margin-right: 50px;
  margin-left: 50px;
}
.rollButtons {
  display: block;
  margin-right: auto;
  margin-left: auto;
}
#bigNumber0,#bigNumber1,#bigNumber2 {
  font-size: 300px;
  line-height: 0.9em;
  margin-bottom: 40px;
}

#rightList {
  margin-left: 30px;
  font-size: 30px;
}

li {
  margin-bottom: 10px;
}

#bot {
  margin-left: 50px;
  margin-top: 20px;
  font-size: 40px;
}

</style>
</head>
<body>
<div id="whole">
  <div class="left">
    <div class="stack", id="top">
      <span class="title" id="championsLeagueTitle" >Champions League</span>
      <span class="title" id="draftLotteryTitle" ></span>
    </div>
    <div class="stack", id="mid">
      <div id="mainButtonDiv">
        <button class="mainButtons" id="master">Begin<br>Rolling<br>for<br>1st Pick</button>
        <button class="mainButtons" id="reset">RESET<br>ALL</button>
      </div>
      <div id="lottoNumbersDiv">
        <div class="numAndButton" id="num1">
          <span class="rollButtons" id="bigNumber0" >?</span>
          <button class="rollButtons" id="roll1">Roll</button>
        </div>
        <div class="numAndButton" id="num2">
          <span class="rollButtons" id="bigNumber1" >?</span>
          <button class="rollButtons" id="roll2">Roll</button>
        </div>
        <div class="numAndButton" id="num3">
          <span class="rollButtons" id="bigNumber2" >?</span>
          <button class="rollButtons" id="roll3">Roll</button>
        </div>
      </div>
    </div>
    <div class="stack" id="bot">
      <span id="caption">Welcome to the Draft Lottery!</span>
    </div>
  </div>
  <div class="right">
    <div id="rightTitle">Draft Position</div>
    <div id="rightList">
      <ol>
        <li id="place1">Team 1</li>
        <li id="place2">Team 2</li>
        <li id="place3">Team 3</li>
        <li id="place4">Team 4</li>
        <li id="place5">Team 5</li>
        <li id="place6">Team 6</li>
        <li id="place7">Team 7</li>
        <li id="place8">Team 8</li>
        <li id="place9">Team 9</li>
        <li id="place10">Team 10</li>
        <li id="place11">Team 11</li>
        <li id="place12">Team 12</li>
      </ol>
    </div>
  </div>  
</div>



<script type="text/javascript">

setup();

var pickNumber = 1;
var pickOrder = [];
var threeRolls = [0,0,0];
var combinationRolls = [];
var teamOddsMap = {
    "Team 1"  :  435, 
    "Team 2"  :  265, 
    "Team 3"  :  165, 
    "Team 4"  :  095, 
    "Team 5"  :  40, 
    "Team 6"  :  0, 
    "Team 7"  :  0, 
    "Team 8"  :  0, 
    "Team 9"  :  0, 
    "Team 10" :  0, 
    "Team 11" :  0, 
    "Team 12" :  0
  };

$('#master').click(function() {
  document.getElementById("roll1").disabled = false;
  document.getElementById("master").disabled = true;
  document.getElementById("bigNumber0").textContent = "0";
  document.getElementById("bigNumber1").textContent = "0";
  document.getElementById("bigNumber2").textContent = "0";
});

$('#reset').click(function() {
  setup();
  document.getElementById("master").disabled = false;
});

$('#roll1').click(function() {
  rollNumber(0);
});

$('#roll2').click(function() {
  rollNumber(1);
  
});

$('#roll3').click(function() {
  rollNumber(2);
});


/**
 * FUNCTIONS
 **/
// function sleep(ms) {
// 	return new Promise(resolve => setTimeout(resolve, ms));
// }
function sleep(ms) {
  var currentTime = new Date().getTime();
  while (currentTime + ms >= new Date().getTime()) { }
}

function setup() { 
  var year = (new Date()).getFullYear();
  document.getElementById("draftLotteryTitle").textContent = "Draft Lottery " + year;
  document.getElementById("roll1").disabled = true;
  document.getElementById("roll2").disabled = true;
  document.getElementById("roll3").disabled = true;
  document.getElementById("bigNumber0").textContent = "?";
  document.getElementById("bigNumber1").textContent = "?";
  document.getElementById("bigNumber2").textContent = "?";
  
}

function rollNumber(nRoll) {
  var elementId = "bigNumber" + nRoll.toString();
  threeRolls[nRoll] = Math.floor(Math.random()*10);
  var elem = document.getElementById(elementId);
  var id = setInterval(roll, 100);
  var count = 0;
  function roll() {
    if (count > 100) {
      clearInterval(id);
      if (nRoll == 0) {
        firstRollLogic();
      } else if (nRoll == 1) {
        secondRollLogic();
      } else {
        finalRollLogic();
      }
    } else {
      count++;
      threeRolls[nRoll] = Math.floor(Math.random()*10);
      elem.textContent = threeRolls[nRoll];
    }
  }
}


function firstRollLogic() {
  document.getElementById("roll2").disabled = false;
  document.getElementById("roll1").disabled = true;
}

function secondRollLogic() {
  document.getElementById("roll3").disabled = false;
  document.getElementById("roll2").disabled = true;
}

function finalRollLogic() {
  var possibleNewCombo = parseInt("" + threeRolls[0] + threeRolls[1] + threeRolls[2]);
  var possibleNewTeam =  determineTeamFromCombo(possibleNewCombo);
  document.getElementById("master").disabled = false;
  if (pickOrder.indexOf(possibleNewTeam) >= 0) {
    //Do the roll again
  } else {
    //Its a new combo
    pickOrder.push(possibleNewTeam);
    updateTextForNewSelection(pickNumber, possibleNewTeam);
    pickNumber++;
  }
}

function determineTeamFromCombo(combo) {
  if (combo < teamOddsMap["Team 1"]) {
    return "Team 1";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"]) {
    return "Team 2";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"] + teamOddsMap["Team 3"]) {
    return "Team 3";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"] + teamOddsMap["Team 3"] + teamOddsMap["Team 4"]) {
    return "Team 4";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"] + teamOddsMap["Team 3"] + teamOddsMap["Team 4"] + teamOddsMap["Team 5"]) {
    return "Team 5";
  } else {
    throw "InvalidCombination";
  }
}

function updateTextForNewSelection(pickNumber, possibleNewTeam) {
  document.getElementById("place" + pickNumber).textContent = possibleNewTeam;
  switch (pickNumber) {
    case 1:
      document.getElementById("master").textContent = "Begin\nRolling\nfor\n2nd Pick";
      document.getElementById("caption").textContent = "The first pick in the Champions League Draft belongs to..." + possibleNewTeam + "!";
      break;
    case 2:
      document.getElementById("master").textContent = "Begin\nRolling\nfor\n3rd Pick";
      document.getElementById("caption").textContent = "The second pick will be made by...\n" + possibleNewTeam + "!";
      break;
    case 3:
      document.getElementById("master").textContent = "Begin\nRolling\nfor\n4th Pick";
      document.getElementById("caption").textContent = "Picking third will be...\n" + possibleNewTeam + "!";
      break;
    case 4:
      document.getElementById("master").textContent = "Begin\nRolling\nfor\n4th Pick";
      document.getElementById("caption").textContent = "The fourth pick in the 2018 Champions League Draft goes to...\n" + possibleNewTeam + "!";
  }
}

</script>

</body>
</html>










