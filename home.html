<!--
# Chris Vrabel
# 5/27/17
# Prediting Game Probabilities

# This is the html file for the webpage of visualizations. Contains the javascript as well. 
-->
<html>
<title>Draft Lottery</title>
<head>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<!-- Load the d3 library. -->
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<style>
/* put a border around the svg element so we can see the coordinate system better. */
body { 
  font-family: "Open Sans"; 
}

.right { 
  float: right; 
  width: 18%; 
  height: 100%;
  border-size: 1px;
  border-style: solid;
  border-color: #6496c8;
  margin: 5px;
}

.left { 
  margin: 10px;
  float: left; 
  width:75%; 
  height:95%;
}

.stack { 
  float: left; 
  width: 100%;
}

#top {
  height: 25%;
}

#mid {
  height: 55%;
}

#bot {
  height: 20%;
}

.title { 
  display: block;
  text-align: center;
  font-size: 60px;
  font-weight: bolder;
  text-overflow: ellipsis;
}

#rightTitle {
  margin-top: 10px;
  height: 8%;
  text-align: center;
  font-size: 30;
  font-weight: bold;
}

#master {
  margin-top: 30px;
}

button {
  margin: 0 auto;
  padding: 7px 22px;
  font-size: 24px;
  font-family: "Bitter",serif;
  line-height: 0.9;
  appearance: none;
  box-shadow: none;
  border-radius: 0;
  color: #fff;
  background-color: #6496c8;
  border: none;
}

button:focus {
  outline: none;
}

button:hover {
  background-color: #346392;
/*  text-shadow: -1px 1px #27496d;
*/}

button:disabled {
  background-color: #b1cae3;
}

button:active {
  background-color: #27496d;
  text-shadow: -1px 1px #193047
}

.mainButtons {
  display: block;
  margin: 5;
  margin-bottom: 20px
}

#mainButtonDiv {
  float: left;
  width: 20%;
  margin-top: 30px;
}

#lottoNumbersDiv {
  float: right;
  width: 80%;
}

.numAndButton {
  display: inline-block;
  margin-right: 50px;
  margin-left: 50px;
}

.rollButtons {
  display: block;
  margin-right: auto;
  margin-left: auto;
}

#bigNumber0,#bigNumber1,#bigNumber2 {
  font-size: 300px;
  line-height: 0.9em;
  margin-bottom: 40px;
}

#rightList {
  margin: 10px;
  margin-left: 15px;
  font-size: 25px;
}

li {
  margin-bottom: 15px;
}

#bot {
  margin-left: 50px;
  margin-top: 20px;
  font-size: 40px;
}

</style>
</head>
<body>
<div id="whole">
  <div class="left">
    <div class="stack", id="top">
      <span class="title" id="championsLeagueTitle" >Champions League</span>
      <span class="title" id="draftLotteryTitle" ></span>
    </div>
    <div class="stack", id="mid">
      <div id="mainButtonDiv">
        <button class="mainButtons" id="master">Roll for #1</button>
        <button class="mainButtons" id="reset">RESET<br>ALL</button>
      </div>
      <div id="lottoNumbersDiv">
        <div class="numAndButton" id="num1">
          <span class="rollButtons" id="bigNumber0" >?</span>
          <button class="rollButtons" id="roll1">Roll</button>
        </div>
        <div class="numAndButton" id="num2">
          <span class="rollButtons" id="bigNumber1" >?</span>
          <button class="rollButtons" id="roll2">Roll</button>
        </div>
        <div class="numAndButton" id="num3">
          <span class="rollButtons" id="bigNumber2" >?</span>
          <button class="rollButtons" id="roll3">Roll</button>
        </div>
      </div>
    </div>
    <div class="stack" id="bot">
      <span id="caption">Welcome to the Draft Lottery!</span>
    </div>
  </div>
  <div class="right">
    <div id="rightTitle">Draft Position</div>
    <div id="rightList">
      <ol>
        <li id="place1">---</li>
        <li id="place2">---</li>
        <li id="place3">---</li>
        <li id="place4">---</li>
        <li id="place5">---</li>
        <li id="place6">Team 6</li>
        <li id="place7">Team 7</li>
        <li id="place8">Team 8</li>
        <li id="place9">Team 9</li>
        <li id="place10">Team 10</li>
        <li id="place11">Team 11</li>
        <li id="place12">Team 12</li>
      </ol>
    </div>
  </div>  
</div>



<script type="text/javascript">

var pickNumber = 1;
var pickOrder = [];
var threeRolls = [0,0,0];
var combinationRolls = [];
var teamHasBeenPickedList = [false, false, false, false, false];
var teamNamesMap = {
    "Team 1"  :  "Scranton Stranglers", 
    "Team 2"  :  "Nuclear Guam", 
    "Team 3"  :  "Big Baller Brown", 
    "Team 4"  :  "Tompkins CAT", 
    "Team 5"  :  "Richmond Rogues", 
    "Team 6"  :  "Ithaca Ivy Leaguers", 
    "Team 7"  :  "Team Synchro", 
    "Team 8"  :  "Boston Jellyfam", 
    "Team 9"  :  "Team Droptop", 
    "Team 10" :  "Luzern's Iron Chef", 
    "Team 11" :  "Wolf Wall", 
    "Team 12" :  "Tysons Traffic"
  };
var teamOddsMap = {
    "Team 1"  :  .435, 
    "Team 2"  :  .265, 
    "Team 3"  :  .165, 
    "Team 4"  :  .095, 
    "Team 5"  :  .04, 
    "Team 6"  :  0, 
    "Team 7"  :  0, 
    "Team 8"  :  0, 
    "Team 9"  :  0, 
    "Team 10" :  0, 
    "Team 11" :  0, 
    "Team 12" :  0
  };

setup();

$('#master').click(function() {
  document.getElementById("roll1").disabled = false;
  document.getElementById("master").disabled = true;
  document.getElementById("bigNumber0").textContent = "0";
  document.getElementById("bigNumber1").textContent = "0";
  document.getElementById("bigNumber2").textContent = "0";
  if (pickNumber == 1) {
    document.getElementById("place1").textContent = "---";
    document.getElementById("place2").textContent = "---";
    document.getElementById("place3").textContent = "---";
    document.getElementById("place4").textContent = "---";
    document.getElementById("place5").textContent = "---";

    document.getElementById("place1").style.fontSize = "25px";
    document.getElementById("place1").style.fontStyle = "normal";
    document.getElementById("place2").style.fontSize = "25px";
    document.getElementById("place2").style.fontStyle = "normal";
    document.getElementById("place3").style.fontSize = "25px";
    document.getElementById("place3").style.fontStyle = "normal";
    document.getElementById("place4").style.fontSize = "25px";
    document.getElementById("place4").style.fontStyle = "normal";
    document.getElementById("place5").style.fontSize = "25px";
    document.getElementById("place5").style.fontStyle = "normal";

  }
});

$('#reset').click(function() {
  setup();
  document.getElementById("master").disabled = false;
});

$('#roll1').click(function() {
  rollNumber(0);
});

$('#roll2').click(function() {
  rollNumber(1);
  
});

$('#roll3').click(function() {
  rollNumber(2);
});


/**
 * FUNCTIONS
 **/

function setup() { 
  pickNumber = 1;
  pickOrder = [];
  threeRolls = [0,0,0];
  var teamHasBeenPickedList = [false, false, false, false, false];
  combinationRolls = [];
  var teamNamesMap = {
    "Team 1"  :  "Scranton Stranglers", 
    "Team 2"  :  "Nuclear Guam", 
    "Team 3"  :  "Big Baller Brown", 
    "Team 4"  :  "Tompkins CAT", 
    "Team 5"  :  "Richmond Rogues", 
    "Team 6"  :  "Ithaca Ivy Leaguers", 
    "Team 7"  :  "Team Synchro", 
    "Team 8"  :  "Boston Jellyfam", 
    "Team 9"  :  "Team Droptop", 
    "Team 10" :  "Luzern's Iron Chef", 
    "Team 11" :  "Wolf Wall", 
    "Team 12" :  "Tysons Traffic"
  };
  teamOddsMap = {
    "Team 1"  :  .435, 
    "Team 2"  :  .265, 
    "Team 3"  :  .165, 
    "Team 4"  :  .095, 
    "Team 5"  :  .04, 
    "Team 6"  :  0, 
    "Team 7"  :  0, 
    "Team 8"  :  0, 
    "Team 9"  :  0, 
    "Team 10" :  0, 
    "Team 11" :  0, 
    "Team 12" :  0
  };

  var year = (new Date()).getFullYear();
  document.getElementById("draftLotteryTitle").textContent = "Draft Lottery " + year;
  document.getElementById("master").textContent = "Roll for #1";
  document.getElementById("roll1").disabled = true;
  document.getElementById("roll2").disabled = true;
  document.getElementById("roll3").disabled = true;
  document.getElementById("bigNumber0").textContent = "?";
  document.getElementById("bigNumber1").textContent = "?";
  document.getElementById("bigNumber2").textContent = "?";
  document.getElementById("caption").textContent = "Welcome to the Draft Lottery!";

  document.getElementById("place1").style.fontSize = "18px";
  document.getElementById("place1").style.fontStyle = "italic";
  document.getElementById("place2").style.fontSize = "18px";
  document.getElementById("place2").style.fontStyle = "italic";
  document.getElementById("place3").style.fontSize = "18px";
  document.getElementById("place3").style.fontStyle = "italic";
  document.getElementById("place4").style.fontSize = "18px";
  document.getElementById("place4").style.fontStyle = "italic";
  document.getElementById("place5").style.fontSize = "18px";
  document.getElementById("place5").style.fontStyle = "italic";
  document.getElementById("place1").textContent = teamNamesMap["Team 1"] + " (" + (teamOddsMap["Team 1"]*100.0) + "%)";
  document.getElementById("place2").textContent = teamNamesMap["Team 2"] + " (" + (teamOddsMap["Team 2"]*100.0) + "%)";
  document.getElementById("place3").textContent = teamNamesMap["Team 3"] + " (" + (teamOddsMap["Team 3"]*100.0) + "%)";
  document.getElementById("place4").textContent = teamNamesMap["Team 4"] + " (" + (teamOddsMap["Team 4"]*100.0) + "%)";
  document.getElementById("place5").textContent = teamNamesMap["Team 5"] + " (" + (teamOddsMap["Team 5"]*100.0) + "%)";
  document.getElementById("place6").textContent = teamNamesMap["Team 6"];
  document.getElementById("place7").textContent = teamNamesMap["Team 7"];
  document.getElementById("place8").textContent = teamNamesMap["Team 8"];
  document.getElementById("place9").textContent = teamNamesMap["Team 9"];
  document.getElementById("place10").textContent = teamNamesMap["Team 10"];
  document.getElementById("place11").textContent = teamNamesMap["Team 11"];
  document.getElementById("place12").textContent = teamNamesMap["Team 12"];
}

function rollNumber(nRoll) {
  var elementId = "bigNumber" + nRoll.toString();
  threeRolls[nRoll] = Math.floor(Math.random()*10);
  var elem = document.getElementById(elementId);
  var id = setInterval(roll, 100);
  var count = 0;
  function roll() {
    if (count > 50) {
      clearInterval(id);
      if (nRoll == 0) {
        firstRollLogic();
      } else if (nRoll == 1) {
        secondRollLogic();
      } else {
        finalRollLogic();
      }
    } else {
      count++;
      threeRolls[nRoll] = Math.floor(Math.random()*10);
      elem.textContent = threeRolls[nRoll];
    }
  }
}

function firstRollLogic() {
  document.getElementById("roll2").disabled = false;
  document.getElementById("roll1").disabled = true;
}

function secondRollLogic() {
  document.getElementById("roll3").disabled = false;
  document.getElementById("roll2").disabled = true;
}

function finalRollLogic() {
  var possibleNewCombo = parseFloat("." + threeRolls[0] + threeRolls[1] + threeRolls[2]);
  var possibleNewTeam =  determineTeamFromCombo(possibleNewCombo);
  document.getElementById("master").disabled = false;
  document.getElementById("roll3").disabled = true;
  if (pickOrder.indexOf(possibleNewTeam) >= 0) {
    //Do the roll again
    document.getElementById("caption").textContent = teamNamesMap[possibleNewTeam] + " has already been drawn. Roll again.";
  } else {
    //Its a new combo
    pickOrder.push(possibleNewTeam);
    updateTextForNewSelection(pickNumber, possibleNewTeam);
    pickNumber++;
  }
}

function determineTeamFromCombo(combo) {
  if (combo < teamOddsMap["Team 1"]) {
    teamHasBeenPickedList[0] = true;
    return "Team 1";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"]) {
    teamHasBeenPickedList[1] = true;
    return "Team 2";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"] + teamOddsMap["Team 3"]) {
    teamHasBeenPickedList[2] = true;
    return "Team 3";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"] + teamOddsMap["Team 3"] + teamOddsMap["Team 4"]) {
    teamHasBeenPickedList[3] = true;
    return "Team 4";
  } else if (combo < teamOddsMap["Team 1"] + teamOddsMap["Team 2"] + teamOddsMap["Team 3"] + teamOddsMap["Team 4"] + teamOddsMap["Team 5"]) {
    teamHasBeenPickedList[4] = true;
    return "Team 5";
  } else {
    throw "InvalidCombination";
  }
}

function updateTextForNewSelection(pickNumber, possibleNewTeam) {
  document.getElementById("place" + pickNumber).textContent = teamNamesMap[possibleNewTeam];
  switch (pickNumber) {
    case 1:
      document.getElementById("master").textContent = "Roll for #2";
      document.getElementById("caption").textContent = "The first pick in the Champions League Draft belongs to..." + teamNamesMap[possibleNewTeam] + "!";
      break;
    case 2:
      document.getElementById("master").textContent = "Roll for #3";
      document.getElementById("caption").textContent = "The second pick will be made by..." + teamNamesMap[possibleNewTeam] + "!";
      break;
    case 3:
      document.getElementById("master").textContent = "Roll for #4";
      document.getElementById("caption").textContent = "Picking third will be..." + teamNamesMap[possibleNewTeam] + "!";
      break;
    case 4:
      document.getElementById("master").textContent = "Done Rolling";
      document.getElementById("master").disabled = true;
      document.getElementById("caption").textContent = "The fourth pick in the 2018 Champions League Draft goes to..." + teamNamesMap[possibleNewTeam] + "!.....which means the 5th pick goes to " + findUnpickedTeam() + "!";
      document.getElementById("place5").textContent = findUnpickedTeam();
  }
}

function findUnpickedTeam() {
  return teamNamesMap["Team " + (teamHasBeenPickedList.indexOf(false) + 1)];
}

</script>

</body>
</html>










